# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Å—Ç–∞–¥–∏—è–º–∏ –∏ —Ä–æ–ª—è–º–∏

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å **–ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è**! –ë–æ–ª—å—à–µ –Ω–µ—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π `has_*_stage` - –≤—Å–µ —Å—Ç–∞–¥–∏–∏, —Ä–æ–ª–∏ –∏ –∏—Ö —Å–≤—è–∑–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ API.

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ:

### –ó–∞–º–µ–Ω–µ–Ω–æ:

-   ‚ùå `has_design_stage`, `has_print_stage`, `has_engraving_stage`, `has_workshop_stage` –≤ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö
-   ‚ùå `has_design_stage`, `has_print_stage`, `has_engraving_stage`, `has_workshop_stage` –≤ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è—Ö –∑–∞–∫–∞–∑–æ–≤
-   ‚ùå –ñ–µ—Å—Ç–∫–∏–µ –º–∞—Å—Å–∏–≤—ã —Å—Ç–∞–¥–∏–π –≤ –∫–æ–¥–µ

### –ù–∞:

-   ‚úÖ **ProductStage** - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å–≤—è–∑—å –ø—Ä–æ–¥—É–∫—Ç–æ–≤ —Å–æ —Å—Ç–∞–¥–∏—è–º–∏
-   ‚úÖ **OrderStageAssignment** - –≥–∏–±–∫–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Å—Ç–∞–¥–∏–∏
-   ‚úÖ **Stage**, **StageRole** - —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ —Å—Ç–∞–¥–∏–∏ –∏ –∏—Ö —Ä–æ–ª–∏

## –ù–æ–≤—ã–µ –º–æ–¥–µ–ª–∏

### Stage (–°—Ç–∞–¥–∏—è)

```php
- name (string) - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –∏–º—è ('design', 'print', etc.)
- display_name (string) - –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è ('–î–∏–∑–∞–π–Ω', '–ü–µ—á–∞—Ç—å')
- description (text) - –æ–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞–¥–∏–∏
- order (integer) - –ø–æ—Ä—è–¥–æ–∫ –≤ —Ä–∞–±–æ—á–µ–º –ø—Ä–æ—Ü–µ—Å—Å–µ
- is_active (boolean) - –∞–∫—Ç–∏–≤–Ω–∞—è —Å—Ç–∞–¥–∏—è
- is_initial (boolean) - –Ω–∞—á–∞–ª—å–Ω–∞—è —Å—Ç–∞–¥–∏—è
- is_final (boolean) - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞–¥–∏—è
- color (string) - —Ü–≤–µ—Ç –¥–ª—è UI
```

### ProductStage (–°–≤—è–∑—å –ø—Ä–æ–¥—É–∫—Ç–∞ —Å–æ —Å—Ç–∞–¥–∏–µ–π)

```php
- product_id (foreign) - ID –ø—Ä–æ–¥—É–∫—Ç–∞
- stage_id (foreign) - ID —Å—Ç–∞–¥–∏–∏
- is_available (boolean) - –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ —Å—Ç–∞–¥–∏—è –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞
- is_default (boolean) - —Å—Ç–∞–¥–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤
```

### OrderStageAssignment (–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ —Å—Ç–∞–¥–∏—é –∑–∞–∫–∞–∑–∞)

```php
- order_assignment_id (foreign) - ID –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
- stage_id (foreign) - ID —Å—Ç–∞–¥–∏–∏
- is_assigned (boolean) - –Ω–∞–∑–Ω–∞—á–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —ç—Ç—É —Å—Ç–∞–¥–∏—é
```

### StageRole (–°–≤—è–∑—å —Å—Ç–∞–¥–∏–∏ —Å —Ä–æ–ª—å—é)

```php
- stage_id (foreign) - ID —Å—Ç–∞–¥–∏–∏
- role_id (foreign) - ID —Ä–æ–ª–∏
- is_required (boolean) - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –ª–∏ —Ä–æ–ª—å –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å—Ç–∞–¥–∏–∏
- auto_assign (boolean) - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —ç—Ç–æ–π —Ä–æ–ª—å—é
```

## API Endpoints

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–¥–∏—è–º–∏

```http
GET /api/stages                    # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å—Ç–∞–¥–∏–∏
POST /api/stages                   # –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç–∞–¥–∏—é
PUT /api/stages/{id}               # –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞–¥–∏—é
DELETE /api/stages/{id}            # –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞–¥–∏—é
POST /api/stages/reorder           # –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å—Ç–∞–¥–∏–π
GET /api/stages/available-roles    # –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–æ–ª–∏
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏

```http
GET /api/roles                     # –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ä–æ–ª–∏
POST /api/roles                    # –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ä–æ–ª—å
PUT /api/roles/{id}               # –û–±–Ω–æ–≤–∏—Ç—å —Ä–æ–ª—å
DELETE /api/roles/{id}            # –£–¥–∞–ª–∏—Ç—å —Ä–æ–ª—å
POST /api/roles/{id}/assign-users  # –ù–∞–∑–Ω–∞—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ —Ä–æ–ª—å
POST /api/roles/{id}/remove-users  # –ò—Å–∫–ª—é—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ —Ä–æ–ª–∏
```

### **–ù–û–í–û–ï**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–¥–∏—è–º–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

```http
GET /api/products/{product}/stages      # –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞–¥–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
PUT /api/products/{product}/stages      # –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å—Ç–∞–¥–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
POST /api/products/{product}/stages     # –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞–¥–∏—é –∫ –ø—Ä–æ–¥—É–∫—Ç—É
DELETE /api/products/{product}/stages/{stage}  # –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞–¥–∏—é –∏–∑ –ø—Ä–æ–¥—É–∫—Ç–∞
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### 1. –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞–¥–∏–π –ø—Ä–æ–¥—É–∫—Ç–∞

```bash
GET /api/products/1/stages
```

**–û—Ç–≤–µ—Ç:**

```json
{
  "product_stages": [
    {
      "id": 1,
      "product_id": 1,
      "stage_id": 2,
      "is_available": true,
      "is_default": false,
      "stage": {
        "id": 2,
        "name": "design",
        "display_name": "–î–∏–∑–∞–π–Ω",
        "color": "#8b5cf6"
      }
    }
  ],
  "available_stages": [...] // –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–∞–¥–∏–∏
}
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–∞–¥–∏–π –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞

```bash
PUT /api/products/1/stages
{
  "stages": [
    {"stage_id": 1, "is_available": true, "is_default": true},   // draft - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    {"stage_id": 2, "is_available": true, "is_default": false}, // design
    {"stage_id": 3, "is_available": true, "is_default": false}, // print
    {"stage_id": 9, "is_available": true, "is_default": false}, // –Ω–æ–≤–∞—è —Å—Ç–∞–¥–∏—è "quality_check"
    {"stage_id": 7, "is_available": true, "is_default": false}  // completed
  ]
}
```

### 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç–∞–¥–∏–∏ "–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞"

**–®–∞–≥ 1:** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ä–æ–ª—å

```bash
POST /api/roles
{
  "name": "quality_controller",
  "display_name": "–ö–æ–Ω—Ç—Ä–æ–ª–µ—Ä –∫–∞—á–µ—Å—Ç–≤–∞",
  "description": "–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞ –ø—Ä–æ–¥—É–∫—Ü–∏–∏"
}
```

**–®–∞–≥ 2:** –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç–∞–¥–∏—é

```bash
POST /api/stages
{
  "name": "quality_check",
  "display_name": "–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞",
  "order": 6,
  "color": "#f59e0b",
  "roles": [
    {"role_id": 6, "is_required": true, "auto_assign": true}
  ]
}
```

**–®–∞–≥ 3:** –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞–¥–∏—é –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –ø—Ä–æ–¥—É–∫—Ç–∞–º

```bash
POST /api/products/1/stages
{
  "stage_id": 9,
  "is_available": true,
  "is_default": false
}
```

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ —Å—Ç–∞–¥–∏—è–º–∏

```bash
POST /api/products
{
  "name": "–ü—Ä–µ–º–∏—É–º –∏–∑–¥–µ–ª–∏–µ",
  "stages": [
    {"stage_id": 1, "is_available": true, "is_default": true},   // draft
    {"stage_id": 2, "is_available": true, "is_default": false}, // design
    {"stage_id": 9, "is_available": true, "is_default": false}, // quality_check
    {"stage_id": 3, "is_available": true, "is_default": false}, // print
    {"stage_id": 7, "is_available": true, "is_default": false}  // completed
  ]
}
```

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### Order Model

```php
// –ë–´–õ–û:
if ($product->has_design_stage) { ... }

// –°–¢–ê–õ–û:
if ($product->hasStage('design')) { ... }
```

### Product Model

```php
// –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:
$product->hasStage('design')           // –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å—Ç–∞–¥–∏–∏
$product->getAvailableStages()         // –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å—Ç–∞–¥–∏–∏
$product->availableStages()            // Eloquent –æ—Ç–Ω–æ—à–µ–Ω–∏–µ
$product->productStages()              // —Å–≤—è–∑—å —Å —Ç–∞–±–ª–∏—Ü–µ–π product_stages
```

### OrderAssignment Model

```php
// –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã:
$assignment->isAssignedToStage('design')    // –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ —Å—Ç–∞–¥–∏—é
$assignment->assignToStage('design')        // –Ω–∞–∑–Ω–∞—á–∏—Ç—å –Ω–∞ —Å—Ç–∞–¥–∏—é
$assignment->removeFromStage('design')      // —É–±—Ä–∞—Ç—å —Å–æ —Å—Ç–∞–¥–∏–∏
$assignment->assignedStages()               // –ø–æ–ª—É—á–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ —Å—Ç–∞–¥–∏–∏
```

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

‚úÖ **–í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!**

-   `has_design_stage` ‚Üí –∑–∞–ø–∏—Å–∏ –≤ `product_stages`
-   `has_print_stage` ‚Üí –∑–∞–ø–∏—Å–∏ –≤ `product_stages`
-   `has_engraving_stage` ‚Üí –∑–∞–ø–∏—Å–∏ –≤ `product_stages`
-   `has_workshop_stage` ‚Üí –∑–∞–ø–∏—Å–∏ –≤ `product_stages`
-   –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ `order_assignments` ‚Üí `order_stage_assignments`

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏:

-   **187 –ø—Ä–æ–¥—É–∫—Ç–æ–≤** ‚Üí **1,308 —Å–≤—è–∑–µ–π –ø—Ä–æ–¥—É–∫—Ç-—Å—Ç–∞–¥–∏—è**
-   **–ù–∞–∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤** ‚Üí **601 —Å–≤—è–∑—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ-—Å—Ç–∞–¥–∏—è**

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚úÖ **100% –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**

-   –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–∫–∞–∑—ã —Ä–∞–±–æ—Ç–∞—é—Ç
-   API endpoints –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å
-   –õ–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –º–µ–∂–¥—É —Å—Ç–∞–¥–∏—è–º–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
-   –°–∏—Å—Ç–µ–º–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### 1. **–ü–æ–ª–Ω–∞—è –≥–∏–±–∫–æ—Å—Ç—å**

```bash
# –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç —Ç–æ–ª—å–∫–æ —Å —Å—Ç–∞–¥–∏—è–º–∏ "design" –∏ "completed"
PUT /api/products/1/stages
{
  "stages": [
    {"stage_id": 1, "is_available": true, "is_default": true},   // draft
    {"stage_id": 2, "is_available": true, "is_default": false}, // design
    {"stage_id": 7, "is_available": true, "is_default": false}  // completed
  ]
}
```

### 2. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–π**

-   –ù–æ–≤—ã–µ —Å—Ç–∞–¥–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞
-   –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ
-   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–æ–ª–µ–π

### 3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**

-   –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞–¥–∏–π
-   –ì–∏–±–∫–∏–µ —Å–≤—è–∑–∏ —Å—Ç–∞–¥–∏–π —Å —Ä–æ–ª—è–º–∏
-   –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –ø–æ —Å—Ç–∞–¥–∏—è–º

### 4. **–£–ø—Ä–∞–≤–ª—è–µ–º–æ—Å—Ç—å**

-   –ü–æ–ª–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API
-   –í–∏–∑—É–∞–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
-   –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–û–±–Ω–æ–≤–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–æ–≤—ã–º–∏ API endpoints
2. **–£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –ø–æ–ª—è** `has_*_stage` –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. **–°–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞–¥–∏—è–º–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ
