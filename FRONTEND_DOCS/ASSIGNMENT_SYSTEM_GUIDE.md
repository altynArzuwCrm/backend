# üéØ –ü–û–õ–ù–û–ï –†–£–ö–û–í–û–î–°–¢–í–û - –°–ò–°–¢–ï–ú–ê –ù–ê–ó–ù–ê–ß–ï–ù–ò–ô

## üìã –û–ë–ó–û–† –ù–û–í–û–ô –°–ò–°–¢–ï–ú–´

–°–∏—Å—Ç–µ–º–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π —Ç–µ–ø–µ—Ä—å **–ø–æ–ª–Ω–æ—Å—Ç—å—é –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è**:

-   ‚úÖ **–°—Ç–∞–¥–∏–∏** —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –ë–î
-   ‚úÖ **–†–æ–ª–∏** —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –ë–î
-   ‚úÖ **–ù–∞–∑–Ω–∞—á–µ–Ω–∏—è** –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Å—Ç–∞–¥–∏—è–º
-   ‚úÖ **–ê–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞** —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –≤ –ë–î

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–ò–°–¢–ï–ú–´

### 1. **–û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Stages    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ StageRoles  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   Roles     ‚îÇ
‚îÇ   (—Å—Ç–∞–¥–∏–∏)  ‚îÇ    ‚îÇ(—Å–≤—è–∑–∫–∞)     ‚îÇ    ‚îÇ  (—Ä–æ–ª–∏)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ                    ‚îÇ                   ‚îÇ
       ‚îÇ            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   Orders    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚îÇ  (–∑–∞–∫–∞–∑—ã)   ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                           ‚îÇ
                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                    ‚îÇOrderAssign- ‚îÇ
                    ‚îÇments        ‚îÇ
                    ‚îÇ(–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è) ‚îÇ
                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2. **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. **–°—Ç–∞–¥–∏—è** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —ç—Ç–∞–ø —Ä–∞–±–æ—Ç—ã (`design`, `print`, `workshop`)
2. **–†–æ–ª—å** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–∏–ø —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ (`designer`, `print_operator`)
3. **StageRole** —Å–≤—è–∑—ã–≤–∞–µ—Ç: –∫–∞–∫–∏–µ —Ä–æ–ª–∏ –Ω—É–∂–Ω—ã –¥–ª—è –∫–∞–∫–æ–π —Å—Ç–∞–¥–∏–∏
4. **OrderAssignment** –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∑–∞–∫–∞–∑ + —Å—Ç–∞–¥–∏–∏

---

## üîÑ –ñ–ò–ó–ù–ï–ù–ù–´–ô –¶–ò–ö–õ –ó–ê–ö–ê–ó–ê

### –≠—Ç–∞–ø 1: **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞**

```javascript
// POST /api/orders
{
  "product_id": 1,
  "client_id": 1,
  "quantity": 10,
  "current_stage": "draft"  // –°—Ç–∞—Ä—Ç–æ–≤–∞—è —Å—Ç–∞–¥–∏—è
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. ‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ —Å—Ç–∞–¥–∏–∏ `draft`
2. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç —Ä–æ–ª–∏ –¥–ª—è —Å—Ç–∞–¥–∏–∏ `draft` –≤ `stage_roles`
3. ‚úÖ **–ê–í–¢–û–ü–û–î–°–¢–ê–ù–û–í–ö–ê**: –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω—É–∂–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏

### –≠—Ç–∞–ø 2: **–ê–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

```sql
-- –õ–æ–≥–∏–∫–∞ –∞–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏
SELECT users.* FROM users
JOIN user_roles ON users.id = user_roles.user_id
JOIN stage_roles ON user_roles.role_id = stage_roles.role_id
WHERE stage_roles.stage_id = 1 -- draft
AND stage_roles.auto_assign = true
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è `OrderAssignment` –∑–∞–ø–∏—Å–∏

### –≠—Ç–∞–ø 3: **–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç–∞–¥–∏—é**

```javascript
// PUT /api/orders/123
{
  "current_stage": "design"  // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –¥–∏–∑–∞–π–Ω
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. ‚úÖ –ó–∞–∫–∞–∑ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Å—Ç–∞–¥–∏—é `design`
2. ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç: –≤—Å–µ –ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ä–æ–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã
3. ‚úÖ **–ê–í–¢–û–ü–û–î–°–¢–ê–ù–û–í–ö–ê**: –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üéØ –¢–ò–ü–´ –ù–ê–ó–ù–ê–ß–ï–ù–ò–ô

### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è**

```javascript
// –í stage_roles —Ç–∞–±–ª–∏—Ü–µ:
{
  "stage_id": 2,      // design
  "role_id": 3,       // designer
  "auto_assign": true, // ‚úÖ –ê–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
  "is_required": true  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Ä–æ–ª—å
}
```

**–ö–æ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

-   –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞
-   –ü—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞–¥–∏–∏ –∑–∞–∫–∞–∑–∞
-   –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π —Ä–æ–ª–∏ –≤ —Å—Ç–∞–¥–∏—é

### 2. **–†—É—á–Ω—ã–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è**

```javascript
// POST /api/order-assignments
{
  "order_id": 123,
  "user_id": 5,
  "role_type": "designer",
  "assigned_stages": [2, 3]  // design, print
}
```

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

-   –ù–∞–∑–Ω–∞—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
-   –£–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—Ç–∞–¥–∏–∏
-   –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å —Å –æ–¥–Ω–æ–≥–æ –Ω–∞ –¥—Ä—É–≥–æ–≥–æ

### 3. **–ì—Ä—É–ø–ø–æ–≤—ã–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è**

```javascript
// PUT /api/orders/123/assignments
{
  "assignments": [
    {
      "user_id": 4,
      "role_type": "designer",
      "assigned_stages": [2]
    },
    {
      "user_id": 7,
      "role_type": "print_operator",
      "assigned_stages": [3]
    }
  ]
}
```

---

## ü§ñ –ê–í–¢–û–ü–û–î–°–¢–ê–ù–û–í–ö–ê - –î–ï–¢–ê–õ–¨–ù–û

### –ü—Ä–∞–≤–∏–ª–∞ –∞–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏:

```php
// –í OrderController –ø—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞–¥–∏–∏:
public function updateStage($orderId, $newStage)
{
    $order = Order::find($orderId);
    $order->current_stage = $newStage;
    $order->save();

    // ü§ñ –ê–í–¢–û–ü–û–î–°–¢–ê–ù–û–í–ö–ê
    $this->autoAssignUsersForStage($order, $newStage);
}

private function autoAssignUsersForStage($order, $stageName)
{
    $stage = Stage::where('name', $stageName)->first();

    // –ù–∞–π—Ç–∏ —Ä–æ–ª–∏ —Å –∞–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º –¥–ª—è —ç—Ç–æ–π —Å—Ç–∞–¥–∏–∏
    $autoAssignRoles = $stage->roles()
        ->where('stage_roles.auto_assign', true)
        ->get();

    foreach ($autoAssignRoles as $role) {
        // –ù–∞–π—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —ç—Ç–æ–π —Ä–æ–ª—å—é
        $availableUsers = $role->users()
            ->where('is_active', true)
            ->get();

        if ($availableUsers->isNotEmpty()) {
            // –ù–∞–∑–Ω–∞—á–∏—Ç—å –ø–µ—Ä–≤–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ
            $user = $availableUsers->first();

            OrderAssignment::create([
                'order_id' => $order->id,
                'user_id' => $user->id,
                'role_type' => $role->name,
            ]);

            // –ü—Ä–∏–≤—è–∑–∞—Ç—å –∫ —Å—Ç–∞–¥–∏–∏
            $assignment = OrderAssignment::latest()->first();
            $assignment->assignToStage($stage->id);
        }
    }
}
```

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∞–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏:

1. **–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å** - –º–µ–Ω–µ–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
2. **–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–µ
3. **–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è** - —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ

---

## üìù –ò–ù–î–ò–í–ò–î–£–ê–õ–¨–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ù–ê–ó–ù–ê–ß–ï–ù–ò–ô

### 1. **–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –∑–∞–∫–∞–∑–µ**

```javascript
// PUT /api/order-assignments/456
{
  "user_id": 8,  // –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  "assigned_stages": [2, 3]  // –¢–µ –∂–µ —Å—Ç–∞–¥–∏–∏
}
```

### 2. **–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞–¥–∏–∏ —É –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è**

```javascript
// PUT /api/order-assignments/456
{
  "assigned_stages": [3, 4, 5]  // –ù–æ–≤—ã–µ —Å—Ç–∞–¥–∏–∏: print, workshop, completed
}
```

### 3. **–î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

```javascript
// POST /api/order-assignments
{
  "order_id": 123,
  "user_id": 9,           // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω–µ—Ä
  "role_type": "designer",
  "assigned_stages": [2]   // –¢–æ–ª—å–∫–æ design
}
```

### 4. **–£–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ —Å—Ç–∞–¥–∏–∏**

```javascript
// DELETE /api/order-assignments/456/stages/2
// –£–±–∏—Ä–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ —Å—Ç–∞–¥–∏–∏ "design"
```

---

## üîß –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–¢–ê–î–ò–Ø–ú–ò –ò –†–û–õ–Ø–ú–ò

### 1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è —Å—Ç–∞–¥–∏–∏**

```javascript
// PUT /api/stages/2
{
  "roles": [
    {
      "role_id": 3,        // designer
      "auto_assign": true,  // ‚úÖ –ê–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
      "is_required": true   // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Ä–æ–ª—å
    },
    {
      "role_id": 4,        // manager
      "auto_assign": false, // –¢–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
      "is_required": false
    }
  ]
}
```

### 2. **–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç–∞–¥–∏–∏ —Å —Ä–æ–ª—è–º–∏**

```javascript
// POST /api/stages
{
  "name": "quality_check",
  "display_name": "–ö–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞",
  "order": 6,
  "color": "#10b981",
  "roles": [
    {
      "role_id": 7,        // quality_manager
      "auto_assign": true,
      "is_required": true
    }
  ]
}
```

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò –û–¢–ß–ï–¢–´

### 1. **–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

```javascript
// GET /api/users/workload
{
  "data": [
    {
      "user_id": 4,
      "name": "–í–∏–∫–∞",
      "role": "designer",
      "active_assignments": 5,
      "stages": ["design", "review"],
      "workload_percentage": 80
    }
  ]
}
```

### 2. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–∞–¥–∏—è–º**

```javascript
// GET /api/stages/statistics
{
  "data": [
    {
      "stage_name": "design",
      "total_orders": 15,
      "completed_orders": 10,
      "avg_completion_time": "2.5 days",
      "assigned_users": 3
    }
  ]
}
```

---

## üéÆ –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: **–°–æ–∑–¥–∞–Ω–∏–µ —Å—Ä–æ—á–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞**

```javascript
// 1. –°–æ–∑–¥–∞–µ–º –∑–∞–∫–∞–∑
const order = await fetch("/api/orders", {
    method: "POST",
    body: JSON.stringify({
        product_id: 1,
        client_id: 5,
        current_stage: "draft",
        priority: "urgent", // –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç
    }),
});

// 2. –ê–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
// 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –Ω–∞–∑–Ω–∞—á–∞–µ–º –≤—Ç–æ—Ä–æ–≥–æ –¥–∏–∑–∞–π–Ω–µ—Ä–∞
await fetch("/api/order-assignments", {
    method: "POST",
    body: JSON.stringify({
        order_id: order.id,
        user_id: 10, // –í—Ç–æ—Ä–æ–π –¥–∏–∑–∞–π–Ω–µ—Ä
        role_type: "designer",
        assigned_stages: [2], // design
    }),
});
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: **–ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–ø—É—Å–∫–µ**

```javascript
// 1. –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const assignments = await fetch(`/api/users/4/assignments?active=true`);

// 2. –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∞–µ–º –Ω–∞ –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
for (const assignment of assignments.data) {
    await fetch(`/api/order-assignments/${assignment.id}`, {
        method: "PUT",
        body: JSON.stringify({
            user_id: 11, // –ó–∞–º–µ—â–∞—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            assigned_stages: assignment.assigned_stages,
        }),
    });
}
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: **–ú–∞—Å—Å–æ–≤–æ–µ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–∏**

```javascript
// –í—Å–µ –∑–∞–∫–∞–∑—ã –≤ —Å—Ç–∞–¥–∏–∏ "design" –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å –Ω–∞ –Ω–æ–≤–æ–≥–æ –¥–∏–∑–∞–π–Ω–µ—Ä–∞
const designOrders = await fetch("/api/orders?current_stage=design");

const bulkReassign = designOrders.data.map((order) => ({
    order_id: order.id,
    old_user_id: 4, // –°—Ç–∞—Ä—ã–π –¥–∏–∑–∞–π–Ω–µ—Ä
    new_user_id: 12, // –ù–æ–≤—ã–π –¥–∏–∑–∞–π–Ω–µ—Ä
    role_type: "designer",
}));

await fetch("/api/assignments/bulk-reassign", {
    method: "POST",
    body: JSON.stringify({ reassignments: bulkReassign }),
});
```

---

## ‚ö° –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ò –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

### 1. **–£–º–Ω–∞—è –∞–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞**

```php
// –ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
private function getBestUserForAssignment($role, $stage, $order)
{
    return User::whereHas('roles', function($query) use ($role) {
        $query->where('name', $role);
    })
    ->where('is_active', true)
    ->withCount(['activeAssignments'])  // –ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç—å
    ->orderBy('active_assignments_count', 'asc')  // –ú–µ–Ω–µ–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –ø–µ—Ä–≤—ã–º
    ->first();
}
```

### 2. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π**

```php
// –ö—ç—à–∏—Ä—É–µ–º —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ
$userWorkload = Cache::remember("user_workload_{$userId}", 300, function() use ($userId) {
    return OrderAssignment::where('user_id', $userId)
        ->where('status', 'active')
        ->count();
});
```

---

## üö® –ö–†–ò–¢–ò–ß–ù–´–ï –ú–û–ú–ï–ù–¢–´

### 1. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**

-   ‚úÖ –í—Å–µ `is_required` —Ä–æ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω—ã
-   ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–º (`is_active = true`)
-   ‚úÖ –†–æ–ª—å –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ
-   ‚úÖ –°—Ç–∞–¥–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –ø—Ä–æ–¥—É–∫—Ç–∞

### 2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**

-   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ Policy
-   ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
-   ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π

### 3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**

```php
// –ü—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
event(new OrderAssigned($order, $user, $stages));

// –ü—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞–¥–∏–∏ - —É–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö
event(new OrderStageChanged($order, $oldStage, $newStage));
```

---

## üéØ –ì–õ–ê–í–ù–´–ï –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ù–û–í–û–ô –°–ò–°–¢–ï–ú–´

### ‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å**

-   –õ—é–±—ã–µ —Å—Ç–∞–¥–∏–∏ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å/—É–±—Ä–∞—Ç—å
-   –õ—é–±—ã–µ —Ä–æ–ª–∏ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å
-   –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∞–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

### ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**

-   –ê–≤—Ç–æ–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
-   –£–º–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏
-   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å**

-   –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
-   –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç–∏
-   –ì–∏–±–∫–∏–µ –æ—Ç—á–µ—Ç—ã

### ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**

-   –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ª—é–±–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç–∞–¥–∏–π
-   –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–æ–ª–µ–π
-   –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–æ–ª—å—à–∏–º–∏ –æ–±—ä–µ–º–∞–º–∏

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ª—é–±—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤! üöÄ**
