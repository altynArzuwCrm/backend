# üîê –°–ò–°–¢–ï–ú–ê –ü–†–ê–í –î–û–°–¢–£–ü–ê - –ù–ê–ó–ù–ê–ß–ï–ù–ò–Ø

## üìã –¢–ï–ö–£–©–ò–ï –ü–†–ê–í–ê –î–û–°–¢–£–ü–ê

### ‚úÖ **–ö–¢–û –ú–û–ñ–ï–¢ –î–ï–õ–ê–¢–¨ –ú–ê–°–°–û–í–´–ï –ù–ê–ó–ù–ê–ß–ï–ù–ò–Ø:**

| –†–æ–ª—å                | –ù–∞–∑–Ω–∞—á–µ–Ω–∏—è | –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è | –û–±–Ω–æ–≤–ª–µ–Ω–∏—è | –ü—Ä–æ—Å–º–æ—Ç—Ä |
| ------------------- | ---------- | -------------- | ---------- | -------- |
| **Admin**           | ‚úÖ –í—Å–µ     | ‚úÖ –í—Å–µ         | ‚úÖ –í—Å–µ     | ‚úÖ –í—Å–µ   |
| **Manager**         | ‚úÖ –í—Å–µ     | ‚úÖ –í—Å–µ         | ‚úÖ –í—Å–µ     | ‚úÖ –í—Å–µ   |
| **Designer**        | ‚ùå –ù–µ—Ç     | ‚ùå –ù–µ—Ç         | ‚ùå –ù–µ—Ç     | ‚úÖ –°–≤–æ–∏  |
| **Print Operator**  | ‚ùå –ù–µ—Ç     | ‚ùå –ù–µ—Ç         | ‚ùå –ù–µ—Ç     | ‚úÖ –°–≤–æ–∏  |
| **Workshop Worker** | ‚ùå –ù–µ—Ç     | ‚ùå –ù–µ—Ç         | ‚ùå –ù–µ—Ç     | ‚úÖ –°–≤–æ–∏  |

---

## üö´ –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –î–û–°–¢–£–ü–ê

### **–ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ Admin + Manager):**

```javascript
// ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
POST / api / orders / { order } / bulk - assign; // 403 Forbidden
POST / api / assignments / bulk - assign; // 403 Forbidden
POST / api / assignments / bulk - reassign; // 403 Forbidden
POST / api / assignments / bulk - update; // 403 Forbidden
```

### **–ï–¥–∏–Ω–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**

```javascript
// ‚úÖ –†–ê–ó–†–ï–®–ï–ù–û Admin + Manager:
POST / api / orders / { order } / assign; // –ù–∞–∑–Ω–∞—á–∏—Ç—å –Ω–∞ –∑–∞–∫–∞–∑
PUT / api / assignments / { id } / status; // –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å
DELETE / api / assignments / { id }; // –£–¥–∞–ª–∏—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

// üîí –û–ì–†–ê–ù–ò–ß–ï–ù–û –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
GET / api / assignments; // –¢–æ–ª—å–∫–æ —Å–≤–æ–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
GET / api / assignments / { id }; // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω
PUT / api / assignments / { id } / status; // –¢–æ–ª—å–∫–æ —Å–≤–æ–∏ (–ù–ï –Ω–∞ "approved")
```

---

## üîç –ü–†–û–í–ï–†–ö–ê –ü–†–ê–í –í –ö–û–î–ï

### **OrderAssignmentPolicy.php:**

```php
public function before($user, $ability)
{
    // Admin –∏ Manager –∏–º–µ—é—Ç –í–°–ï –ø—Ä–∞–≤–∞
    if ($user->hasAnyRole(['admin', 'manager'])) {
        return true;
    }
}

public function assign(User $user)
{
    // –¢–æ–ª—å–∫–æ Admin –∏ Manager –º–æ–≥—É—Ç –Ω–∞–∑–Ω–∞—á–∞—Ç—å
    return $user->hasAnyRole(['admin', 'manager']);
}

public function viewAny(User $user)
{
    if ($user->hasAnyRole(['admin', 'manager'])) {
        return true; // –í–∏–¥—è—Ç –í–°–ï –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
    }

    return $user->assignedOrders()->exists(); // –¢–æ–ª—å–∫–æ –°–í–û–ò
}

public function updateStatus(User $user, OrderAssignment $assignment)
{
    if ($user->hasAnyRole(['admin', 'manager'])) {
        return true; // –ú–æ–≥—É—Ç –º–µ–Ω—è—Ç—å –õ–Æ–ë–û–ô —Å—Ç–∞—Ç—É—Å
    }

    // –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –°–í–û–ò –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
    if ($user->id === $assignment->user_id) {
        return true; // –ù–æ –ù–ï –Ω–∞ "approved" (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ)
    }

    return false;
}
```

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–†–ê–í –î–û–°–¢–£–ü–ê

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**

```javascript
// GET /api/me
{
  "id": 1,
  "name": "Aylana",
  "roles": [
    {
      "id": 1,
      "name": "admin",
      "display_name": "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"
    }
  ]
}
```

### **–¢–µ—Å—Ç –ø—Ä–∞–≤ –Ω–∞ –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**

```bash
# –ö–∞–∫ Admin/Manager (—É—Å–ø–µ—Ö):
curl -X POST /api/assignments/bulk-assign \
  -H "Authorization: Bearer {admin_token}" \
  -d '{"assignments": [...]}'
# ‚Üí 201 Created

# –ö–∞–∫ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–æ—à–∏–±–∫–∞):
curl -X POST /api/assignments/bulk-assign \
  -H "Authorization: Bearer {user_token}" \
  -d '{"assignments": [...]}'
# ‚Üí 403 Forbidden: "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω"
```

---

## ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ê –ü–†–ê–í (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)

### **–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–∞—Ç—å –ø—Ä–∞–≤–∞ –¥—Ä—É–≥–∏–º —Ä–æ–ª—è–º:**

1. **–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª–∏—Ç–∏–∫—É:**

```php
// app/Policies/OrderAssignmentPolicy.php
public function assign(User $user)
{
    // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ä–æ–ª—å, –Ω–∞–ø—Ä–∏–º–µ—Ä 'supervisor'
    return $user->hasAnyRole(['admin', 'manager', 'supervisor']);
}
```

2. **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ä–æ–ª—å:**

```php
// –í —Å–∏–¥–µ—Ä–µ –∏–ª–∏ —á–µ—Ä–µ–∑ API
Role::create([
    'name' => 'supervisor',
    'display_name' => '–°—É–ø–µ—Ä–≤–∞–π–∑–µ—Ä',
    'description' => '–ú–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è–º–∏'
]);
```

3. **–ù–∞–∑–Ω–∞—á–∏—Ç—å —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**

```javascript
// POST /api/roles/{role_id}/assign-users
{
  "user_ids": [5, 6, 7]
}
```

---

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### **–ü—Ä–∏–Ω—Ü–∏–ø—ã:**

1. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞** - –∫–∞–∂–¥—ã–π –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —á—Ç–æ –Ω—É–∂–Ω–æ
2. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–µ–π** - –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ —É —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–π
3. **–ê—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π** - –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —É—Ä–æ–≤–Ω–µ** - –ø–æ–ª–∏—Ç–∏–∫–∏ + –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**

```php
// –í—Å–µ –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è:
Log::info('–ú–∞—Å—Å–æ–≤–æ–µ –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ', [
    'assignment_id' => $assignment->id,
    'old_user_id' => $oldUser->id,
    'new_user_id' => $newUser->id,
    'reason' => $reason,
    'reassigned_by' => Auth::user()->id
]);
```

---

## üìä –¢–ï–ö–£–©–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò –ò –†–û–õ–ò

```javascript
// GET /api/users - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—è–º–∏
{
  "data": [
    {
      "id": 1,
      "name": "Aylana",
      "roles": ["admin"],
      "can_assign": true,
      "can_bulk_assign": true
    },
    {
      "id": 2,
      "name": "Test",
      "roles": ["manager"],
      "can_assign": true,
      "can_bulk_assign": true
    },
    {
      "id": 4,
      "name": "–í–∏–∫–∞",
      "roles": ["designer"],
      "can_assign": false,
      "can_bulk_assign": false
    }
  ]
}
```

---

## ‚úÖ –ò–¢–û–ì–û–í–´–ï –ü–†–ê–í–ò–õ–ê

### **–ú–ê–°–°–û–í–´–ï –û–ü–ï–†–ê–¶–ò–ò = –¢–û–õ–¨–ö–û ADMIN + MANAGER**

| –û–ø–µ—Ä–∞—Ü–∏—è        | Admin | Manager | Designer | Print Op | Workshop |
| --------------- | ----- | ------- | -------- | -------- | -------- |
| `bulk-assign`   | ‚úÖ    | ‚úÖ      | ‚ùå       | ‚ùå       | ‚ùå       |
| `bulk-reassign` | ‚úÖ    | ‚úÖ      | ‚ùå       | ‚ùå       | ‚ùå       |
| `bulk-update`   | ‚úÖ    | ‚úÖ      | ‚ùå       | ‚ùå       | ‚ùå       |

### **–ï–î–ò–ù–ò–ß–ù–´–ï –û–ü–ï–†–ê–¶–ò–ò = –û–ì–†–ê–ù–ò–ß–ï–ù–ù–´–ï**

| –û–ø–µ—Ä–∞—Ü–∏—è        | Admin    | Manager  | –û—Å—Ç–∞–ª—å–Ω—ã–µ                      |
| --------------- | -------- | -------- | ------------------------------ |
| `assign`        | ‚úÖ –í—Å–µ   | ‚úÖ –í—Å–µ   | ‚ùå –ù–µ—Ç                         |
| `view`          | ‚úÖ –í—Å–µ   | ‚úÖ –í—Å–µ   | ‚úÖ –¢–æ–ª—å–∫–æ —Å–≤–æ–∏                 |
| `update-status` | ‚úÖ –õ—é–±–æ–π | ‚úÖ –õ—é–±–æ–π | üîí –¢–æ–ª—å–∫–æ —Å–≤–æ–∏ (–ù–ï "approved") |

**–°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ! üîí**
